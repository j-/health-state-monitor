<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/monitor.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/j-/health-state-monitor" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/monitor.js~Monitor.html">Monitor</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/states.js~State.html">State</a></span></li>
</ul>
</div>





<div data-ice="variableWrap">
  <h2><a href="variable/">Variable</a></h2>
  <ul>
    
  <li data-ice="variableDoc"><span><a href="variable/index.html#static-variable-STATES">STATES</a></span></li>
</ul>
</div>




</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/monitor.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import STATES from &apos;./states&apos;;

/**
 * Main health state monitor class.
 */
export default class Monitor {
	/**
	 * Create a new instance of the system health state monitor class.
	 * @param {Object} [options] Options to assign to this instance
	 */
	constructor (options = {}) {
		/**
		 * When the monitor was last notified that the system was healthy.
		 * @type {Date}
		 */
		this.lastPing = null;
		/**
		 * Number of milliseconds until the state will change to &apos;warning&apos;.
		 * @type {Number}
		 */
		this.warningThreshold = null;
		/**
		 * Number of milliseconds until the state will change to &apos;danger&apos;.
		 * @type {Number}
		 */
		this.dangerThreshold = null;
		Object.assign(this, options);
	}

	/**
	 * Notify the monitor that a system message has been received.
	 * @param {Date|Number|String} [date=now] When the message was received
	 * @return {Date} The new `lastPing` value
	 */
	ping (date = Date.now()) {
		this.lastPing = new Date(date);
		return this.lastPing;
	}

	/**
	 * Find the state at a given time; past, present or future.
	 * @param {Date} time Time to check
	 * @return {State} System state
	 */
	getStateAtTime (time) {
		const { dangerTime, warningTime } = this;
		const invalidTime = !time || isNaN(time);
		const invalidDangerTime = !dangerTime || isNaN(dangerTime);
		const invalidWarningTime = !warningTime || isNaN(warningTime);
		// The time or either threshold is invalid
		if (invalidTime || invalidWarningTime || invalidDangerTime) {
			return STATES.UNKNOWN;
		}
		// The current time has passed the danger time
		else if (time &gt;= dangerTime) {
			return STATES.DANGER;
		}
		// The current time has passed the warning time
		else if (time &gt;= warningTime) {
			return STATES.WARNING;
		}
		// Everything is OK
		return STATES.HEALTHY;
	}

	/**
	 * The current system state.
	 * @type {State} System state
	 */
	get state () {
		return this.getStateAtTime(Date.now());
	}

	/**
	 * The time when state will change from &apos;healthy&apos; to &apos;warning&apos;.
	 * @type {Date}
	 */
	get warningTime () {
		const lastPing = Number(this.lastPing);
		const threshold = this.warningThreshold;
		if (isNaN(lastPing) || threshold === null || isNaN(threshold)) {
			return new Date(NaN);
		}
		return new Date(lastPing + threshold);
	}

	/**
	 * The time when state will change from &apos;warning&apos; to &apos;danger&apos;.
	 * @type {Date}
	 */
	get dangerTime () {
		const lastPing = Number(this.lastPing);
		const threshold = this.dangerThreshold;
		if (isNaN(lastPing) || threshold === null || isNaN(threshold)) {
			return new Date(NaN);
		}
		return new Date(lastPing + threshold);
	}
}

Object.defineProperty(Monitor, &apos;STATES&apos;, {
	get: () =&gt; STATES,
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.2.5)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
